// Services/ApiClient.cs

using System;

using System.Net.Http;

using System.Net.Http.Headers;

using System.Text;

using System.Text.Json;

using System.Threading.Tasks;
 
public class ApiClient : IApiClient

{

    private readonly HttpClient _httpClient;

    private readonly JsonSerializerOptions _jsonOptions;
 
    public ApiClient(HttpClient httpClient)

    {

        _httpClient = httpClient;

        _jsonOptions = new JsonSerializerOptions

        {

            PropertyNamingPolicy = JsonNamingPolicy.CamelCase,

            WriteIndented = true

        };

    }
 
    public async Task<T> GetAsync<T>(string endpoint)

    {

        var response = await _httpClient.GetAsync(endpoint);

        response.EnsureSuccessStatusCode();

        var content = await response.Content.ReadAsStringAsync();

        return JsonSerializer.Deserialize<T>(content, _jsonOptions);

    }
 
    public async Task<T> PostAsync<T>(string endpoint, object data)

    {

        var json = JsonSerializer.Serialize(data, _jsonOptions);

        var content = new StringContent(json, Encoding.UTF8, "application/json");

        var response = await _httpClient.PostAsync(endpoint, content);

        response.EnsureSuccessStatusCode();

        var responseContent = await response.Content.ReadAsStringAsync();

        return JsonSerializer.Deserialize<T>(responseContent, _jsonOptions);

    }
 
    public async Task<T> PutAsync<T>(string endpoint, object data)

    {

        var json = JsonSerializer.Serialize(data, _jsonOptions);

        var content = new StringContent(json, Encoding.UTF8, "application/json");

        var response = await _httpClient.PutAsync(endpoint, content);

        response.EnsureSuccessStatusCode();

        var responseContent = await response.Content.ReadAsStringAsync();

        return JsonSerializer.Deserialize<T>(responseContent, _jsonOptions);

    }
 
    public async Task<bool> DeleteAsync(string endpoint)

    {

        var response = await _httpClient.DeleteAsync(endpoint);

        return response.IsSuccessStatusCode;

    }
 
    public async Task<T> PostFormDataAsync<T>(string endpoint, MultipartFormDataContent formData)

    {

        var response = await _httpClient.PostAsync(endpoint, formData);

        response.EnsureSuccessStatusCode();

        var responseContent = await response.Content.ReadAsStringAsync();

        return JsonSerializer.Deserialize<T>(responseContent, _jsonOptions);

    }
 
    // Helper method to set authentication header

    public void SetAuthenticationHeader(string scheme, string parameter)

    {

        _httpClient.DefaultRequestHeaders.Authorization = 

            new AuthenticationHeaderValue(scheme, parameter);

    }
 
    // Helper method to set custom headers

    public void SetHeader(string name, string value)

    {

        if (_httpClient.DefaultRequestHeaders.Contains(name))

            _httpClient.DefaultRequestHeaders.Remove(name);

        _httpClient.DefaultRequestHeaders.Add(name, value);

    }

}
 


